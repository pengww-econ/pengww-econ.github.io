
<!DOCTYPE html>
<html lang="zh-CN">

<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>深圳市大数据研究院-法律研究人员岗位申请</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
:root {
--primary-color: #4f8cff;
--primary-hover: #3b6fd8;
--success-color: #198754;
--light-gray: #f8f9fa;
--text-color: #34495e;
--border-color: #ced4da;
--body-bg: #f0f2f5;
--container-bg: #ffffff;
--border-radius: 0.5rem;
--shadow: 0 6px 30px 0 rgba(0, 0, 0, 0.07);
}

body { padding: 2rem 0; background-color: var(--body-bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 15px; }
.container { max-width: 800px; background: var(--container-bg); box-shadow: var(--shadow); border-radius: 1rem; padding: 2.5rem; }
.required::after { content: " *"; color: #d00; font-weight: bold; }
fieldset { border: 1px solid var(--border-color); padding: 1.5rem 1.75rem; border-radius: var(--border-radius); margin-bottom: 2rem; background-color: var(--light-gray); }
legend { width: auto; padding: 0 .5rem; font-weight: 600; font-size: 1.2rem; color: var(--text-color); }
.form-label { font-weight: 500; color: var(--text-color); margin-bottom: 0.5rem; }
.form-control, .form-select { border-radius: var(--border-radius); transition: border-color .2s, box-shadow .2s; border: 1px solid var(--border-color); }
.form-control:focus, .form-select:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(79, 140, 255, 0.2); }

.file-upload-wrapper { position: relative; }
.file-upload-wrapper .form-control.is-valid { border-color: var(--success-color); background-color: #e8f5e9; }
.file-upload-wrapper::after { font-family: 'bootstrap-icons'; content: '\F59F'; position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: #6c757d; font-size: 1.2rem; transition: all .2s; }
.file-upload-wrapper.is-uploading::after { content: ''; box-sizing: border-box; position: absolute; top: 50%; right: 1rem; width: 20px; height: 20px; margin-top: -10px; border: 2px solid var(--primary-color); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
.file-upload-wrapper.is-valid::after { content: '\F26A'; color: var(--success-color); animation: none; }
@keyframes spin { to { transform: rotate(360deg); } }

.btn-primary { background: linear-gradient(90deg, var(--primary-color) 0, var(--primary-hover) 100%); border: none; border-radius: var(--border-radius); font-size: 1.15rem; font-weight: 600; padding: .75rem 0; box-shadow: 0 4px 12px 0 rgba(79, 140, 255, 0.2); transition: all .2s; }
.btn-primary:hover, .btn-primary:focus { background: linear-gradient(90deg, var(--primary-hover) 0, var(--primary-color) 100%); box-shadow: 0 6px 18px 0 rgba(79, 140, 255, 0.25); transform: translateY(-2px); }

.case-section h4 { font-size: 1.25rem; color: #333; }
.case-card { background-color: #fff; border: 1px solid #dee2e6; padding: 1.25rem; border-radius: var(--border-radius); margin-bottom: 1rem; }
.case-card h5 { color: var(--primary-color); }
.case-card ul { padding-left: 1.2rem; margin-bottom: 0.5rem; }
.case-card ul li { margin-bottom: 0.5rem; }
.judge-info { background-color: #e9ecef; padding: 1rem; border-radius: var(--border-radius); }
.row > [class*="col-"] > .case-card { height: 100%; }

.question-group { margin-bottom: 1.75rem; border-bottom: 1px solid #eee; padding-bottom: 1.75rem; }
.question-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0;}
.question-title { font-weight: 600; margin-bottom: 0.85rem; color: #333; }
.ab-choice .form-check { width: 100%; padding: 0.75rem 1.25rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); background-color: #fff; transition: all 0.2s; }
.ab-choice .form-check:not(:last-child) { margin-bottom: 0.75rem; }
.ab-choice .form-check-input { display: none; }
.ab-choice .form-check-input:checked + .form-check-label { border-color: var(--primary-color); background-color: #eaf2ff; box-shadow: 0 0 0 2px var(--primary-color); }
.ab-choice .form-check-label { width: 100%; cursor: pointer; }
.likert-group { display: flex; justify-content: space-around; flex-wrap: wrap; background-color: #fff; padding: 0.75rem; border-radius: var(--border-radius); border: 1px solid var(--border-color); }
.likert-group .form-check { margin: 0.25rem 0.5rem; }
.climate-group .range-value { font-weight: bold; color: var(--primary-color); min-width: 40px; text-align: right; }

.process-explainer { background-color: #eaf2ff; border: 1px solid #b6d4fe; color: #0a4ebd; padding: 1.25rem; border-radius: var(--border-radius); }

@media (max-width: 768px) {
    body { padding: 1rem 0; font-size: 14px; }
    .container { padding: 1.5rem; }
    fieldset { padding: 1.2rem 1rem; }
    header {
        flex-direction: column;
        text-align: center;
    }
    header img {
        margin-right: 0 !important;
        margin-bottom: 1rem;
        width: 180px !important;
    }
}
</style>
</head>

<body>
<div class="container">

<div id="step1">
<header class="d-flex align-items-center mb-4 pb-3 border-bottom">
<img src="szbigdata.png" alt="深圳大数据研究院 Logo" style="width: 220px; height: auto; margin-right: 1.25rem;">
<div>
<h1 class="h5 mb-1 fw-bold">深圳市大数据研究院 · 2025年招聘</h1>
<p class="text-muted mb-0">（高级）法律研究人员岗位申请</p>
</div>
</header>

<div class="card mb-4">
<div class="card-header fw-bold">招聘启事详情</div>
<div class="card-body">
<p><strong>法律研究人员、高级法律研究人员（配合大模型研发）</strong></p>
<p><strong>薪水：</strong>15k-35k，15薪</p>
<p><strong>单位简介：</strong> 深圳市大数据研究院（Shenzhen Research Institute of Big Data)，是在深圳市委、市政府的支持下于2016年3月组建成立的市属二类事业单位，其前身是香港中文大学（深圳）副校长罗智泉院士领衔的大数据信息处理及应用创新团队。2019年，研究院被正式授牌成为深圳市基础研究机构之一。</p>
<p>研究院法律大数据和人工智能团队，现承担司法部与科技部多项重点实验室和国家计划任务，致力于开发法律大模型、智能体及数据中台。我们真诚希望能够打造法律数据和法律人工智能领域的世界级产品，期待有志于长期在法律科技行业深耕的同仁加入，与我们的团队一起成长和创造。</p>
<hr>
<p><strong>主要工作内容：</strong></p>
<ul>
 <li>参与或牵头组织法律研究团队，与技术团队对接，共同开展法律大模型研发；对法律实务部门开展调研、法律研究、法律文书要素总结和梳理等。</li>
 <li>与大数据团队合作，完成调研报告的撰写。</li>
 <li>参与项目日常组织工作，包括跟进项目进度、组织会议、协调工作等。</li>
</ul>
<p><strong>任职要求：</strong></p>
<ul>
 <li><strong>学历与专业：</strong>法学及相关专业硕士及以上；对法学有深入了解的计算机、经管、数据科学类专业亦可。</li>
 <li><strong>工作经验：</strong>3-5年工作经验优先，包括司法机关、政府部门、律所、企业法务、法律科技企业等。</li>
 <li><strong>职业素养：</strong>对法律科技领域具有浓厚兴趣，有扎实的法学或法律实务功底。</li>
</ul>
</div>
</div>

<div class="process-explainer my-4">
<h5 class="fw-bold d-flex align-items-center"><i class="bi bi-info-circle-fill me-2"></i>申请流程说明</h5>
<p class="mb-0">以下流程共分两页，预计总共用时约10分钟。第一页请您填写基本信息并上传申请材料；第二页请您配合我们填写一份匿名的调查问卷（仅用于学术研究）。在两页全部完成后，您可以正式提交您的申请。感谢您的配合！</p>
</div>

<form id="infoForm" autocomplete="off">
<fieldset>
<legend>一、基本信息</legend>
<div class="row g-3">
<div class="col-md-6"><label class="form-label required">姓名</label><input name="name" class="form-control" required placeholder="请输入姓名"></div>
<div class="col-md-6"><label class="form-label required">性别</label><select name="gender" class="form-select" required><option value="">请选择</option><option>男</option><option>女</option></select></div>
<div class="col-md-6"><label class="form-label required">出生年份</label><select name="birth_year" class="form-select" required></select></div>
<div class="col-md-6"><label class="form-label required">手机号</label><input name="phone" class="form-control" pattern="[0-9]{11}" required placeholder="请输入11位手机号"></div>
<div class="col-md-6"><label class="form-label required">邮箱</label><input type="email" name="email" class="form-control" required placeholder="请输入邮箱"></div>
<div class="col-md-6"><label class="form-label required">当前城市</label><input name="city" class="form-control" required placeholder="请输入当前城市"></div>
<div class="col-md-6"><label class="form-label required">最高学历</label><select name="education" class="form-select" required><option value="">请选择</option><option>本科</option><option>硕士</option><option>博士</option></select></div>
<div class="col-md-6"><label class="form-label required">毕业院校</label><input name="university" class="form-control" required placeholder="请输入毕业院校"></div>
<div class="col-md-6"><label class="form-label required">毕业年份</label><select name="graduation_year" class="form-select" required></select></div>
<div class="col-md-6"><label class="form-label required">所学专业</label><input name="major" class="form-control" required placeholder="请输入所学专业"></div>
<div class="col-md-6"><label class="form-label required">当前状态</label><select name="status" class="form-select" required><option>在读</option><option>求职中</option><option>在职</option></select></div>
</div>
</fieldset>

<fieldset>
<legend>二、上传材料</legend>
<div class="mb-3">
<label class="form-label required">个人简历（PDF/Word ≤20 MB）</label>
<div class="file-upload-wrapper">
<input class="form-control" type="file" id="cv" accept=".pdf,.doc,.docx" required>
</div>
<input type="hidden" name="cv_url">
</div>

<div class="form-text text-primary fw-bold mt-2 mb-3">
<i class="bi bi-info-circle-fill me-1"></i>
请注意：若最高学历选择“硕士”或“博士”，则对应的学位论文为必填项。
</div>

<div class="mb-3">
<label class="form-label">本科论文（可选，PDF/Word ≤50 MB）</label>
<div class="file-upload-wrapper">
<input class="form-control" type="file" id="bachelor_thesis" accept=".pdf,.doc,.docx">
</div>
<input type="hidden" name="bachelor_thesis_url">
</div>
 <div class="mb-3">
<label class="form-label">硕士论文（PDF/Word ≤50 MB）</label>
<div class="file-upload-wrapper">
<input class="form-control" type="file" id="master_thesis" accept=".pdf,.doc,.docx">
</div>
<input type="hidden" name="master_thesis_url">
</div>
<div class="mb-3">
<label class="form-label">博士论文（PDF/Word ≤50 MB）</label>
<div class="file-upload-wrapper">
<input class="form-control" type="file" id="phd_thesis" accept=".pdf,.doc,.docx">
</div>
<input type="hidden" name="phd_thesis_url">
</div>

<div class="form-text">⚠️ 选择文件后将自动上传，成功后输入框会变绿并显示<i class="bi bi-check-circle-fill text-success ms-1"></i>图标。</div>
</fieldset>

<button class="btn btn-primary btn-lg w-100" type="submit" id="infoSubmitBtn">
<span class="btn-text">下一页</span>
</button>
</form>
</div>

<div id="step2" style="display:none;">
<h2 class="fw-bold text-center mb-4">补充问卷</h2>
<form id="surveyForm" autocomplete="off">
   <div class="alert alert-secondary">
    <h5 class="alert-heading">作答说明</h5>
    <p>我们下面邀请您回答一份学术研究问卷。本问卷由上海交通大学研究团队设计，旨在深入了解专业人士的决策模式与行为习惯。</p>
    <p class="mb-1"><strong>核心原则：</strong></p>
    <ul style="padding-left: 20px; margin-bottom: 1rem;">
     <li><strong>完全匿名：</strong>您的所有回答将由上海交通大学研究团队直接、独立地收集与分析，全程严格保密，并<strong>绝对不会</strong>与深圳市大数据研究院共享。</li>
     <li><strong>招聘无关：</strong>问卷结果与您的招聘申请<strong>完全无关</strong>，请安心根据真实想法作答。</li>
    </ul>
    <p class="mb-0">问卷预计需要 5-7 分钟。所有题目均无对错之分，若对两个选项感受相似，请选择相对更贴近您想法的一项即可。感谢您的时间和投入！</p>
   </div>
 <fieldset>
 <legend>补充问卷</legend>
    <div id="questions-container">
        </div>
 </fieldset>
 <button class="btn btn-primary btn-lg w-100" type="submit" id="surveySubmitBtn">提交问卷</button>
</form>
</div>

<footer class="mt-5 text-center small text-muted">
</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// 全局变量
let activeUploads = 0;
let step1Behavior = { firstClickTime: null, lastClickTime: null, clickCount: 0 };
let step2Behavior = { firstClickTime: null, lastClickTime: null, clickCount: 0 };
let currentStep = 1;
let applyId = null;
let firstStepContent = "";

// ==================== 可配置项 START ====================

/**
 * 问卷题目顺序的种子。
 * 修改此处的数字可生成一个全新的、但固定的题目顺序。
 * 只要种子相同，每个用户看到的题目顺序就完全相同。
 */
const SURVEY_SEED = 520;

// ==================== 可配置项 END ======================


const SCALE_LIKERT = ['非常不同意', '不同意', '一般', '同意', '非常同意'];
const SCALE_FREQ = ['从不', '很少', '有时', '经常', '非常频繁'];
const SCALE_STRESS = ['完全不', '轻微', '中等', '较高', '极度'];

// 初始化函数

function renderLikertScale(containerId, name, options) {
const container = document.getElementById(containerId);
if (!container) return;
container.innerHTML = options.map((opt, i) => `<div class="form-check"><input type="radio" class="form-check-input" name="${name}" value="${i+1}" id="${name}-${i}" required><label class="form-check-label" for="${name}-${i}">${opt}</label></div>`).join('');
}

/**
 * 创建一个基于种子的伪随机数生成器 (PRNG)。
 * @param {number} seed - 初始种子。
 * @returns {function(): number} - 一个函数，每次调用返回一个在 [0, 1) 区间内的伪随机数。
 */
function createSeededRandom(seed) {
    let state = seed;
    // 使用 LCG (线性同余生成器) 算法
    const a = 1664525;
    const c = 1013904223;
    const m = 2**32;

    return function() {
        state = (a * state + c) % m;
        return state / m;
    };
}


(() => {
const sel = document.querySelector('[name="birth_year"]'), now = new Date().getFullYear();
let options = '<option value="">请选择</option>';
for (let y = now - 18; y >= now - 70; y--) options += `<option value="${y}">${y}</option>`;
sel.innerHTML = options;
})();

(() => {
const sel = document.querySelector('[name="graduation_year"]'), now = new Date().getFullYear();
let options = '<option value="">请选择</option>';
for (let y = now + 1; y >= now - 70; y--) options += `<option value="${y}">${y}</option>`;
sel.innerHTML = options;
})();

document.addEventListener('DOMContentLoaded', function() {
    
    const allQuestions = [
        { html: `<div class="question-group"><div class="question-title required">在与他人交流时，您认为哪种做法更能促进有效沟通？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q1" id="new_q1a" value="A" required><label class="form-check-label" for="new_q1a">A. 根据对方的反馈调整自己的表达方式</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q1" id="new_q1b" value="B" required><label class="form-check-label" for="new_q1b">B. 坚持信息的清晰与完整性</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">在物品管理上，您认为哪种做法更有助于日常运作？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q3" id="new_q3a" value="A" required><label class="form-check-label" for="new_q3a">A. 将工作用品与个人物品分别存放</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q3" id="new_q3b" value="B" required><label class="form-check-label" for="new_q3b">B. 将常用物品集中存放以提高取用便捷性</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于报销出差期间的零散交通费，您更认同哪种做法？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="honesty_resource" id="honesty_resource_a" value="A" required><label class="form-check-label" for="honesty_resource_a">A. 严格按照实际发生的金额进行报销，确保每一笔都有据可循。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="honesty_resource" id="honesty_resource_b" value="B" required><label class="form-check-label" for="honesty_resource_b">B. 在公司规定的额度内，将一些不易获取票据的零星花费（如地铁、公交）进行合理的合并申报，是一种可接受的便捷方式。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">在给予同事反馈时，您认为哪种方式更重要？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q2" id="added_q2a" value="A" required><label class="form-check-label" for="added_q2a">A. 优先考虑对方的感受，以鼓励和肯定的方式提出建议</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q2" id="added_q2b" value="B" required><label class="form-check-label" for="added_q2b">B. 优先考虑问题的清晰度，直接客观地指出需要改进之处</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">对于长远的职业发展，您认为哪个是更根本的基础？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q_loc" id="added_q_loc_a" value="A" required><label class="form-check-label" for="added_q_loc_a">A. 个人的持续投入与能力提升</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q_loc" id="added_q_loc_b" value="B" required><label class="form-check-label" for="added_q_loc_b">B. 所处行业环境的机遇与趋势</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">遇到意见分歧时，您觉得哪种方式更有助于问题解决？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q4" id="new_q4a" value="A" required><label class="form-check-label" for="new_q4a">A. 通过平和讨论寻找共同点</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q4" id="new_q4b" value="B" required><label class="form-check-label" for="new_q4b">B. 通过观点碰撞激发新思路</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">为了确保任务按时完成，您更倾向于哪种做法？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q6" id="new_q6a" value="A" required><label class="form-check-label" for="new_q6a">A. 提前为任务设定固定的内部截止日期并严格遵守</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q6" id="new_q6b" value="B" required><label class="form-check-label" for="new_q6b">B. 在项目进行中灵活调整时间安排以应对实际进展</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于与不同类型的人打交道，您更认同哪种方式？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q_sm" id="added_q_sm_a" value="A" required><label class="form-check-label" for="added_q_sm_a">A. 保持自己一贯的沟通风格，以真诚和一致性建立信任</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q_sm" id="added_q_sm_b" value="B" required><label class="form-check-label" for="added_q_sm_b">B. 灵活调整自己的互动方式，以更好地适应对方的习惯和需求</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">在团队会议中，您通常的角色是？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q3" id="added_q3a" value="A" required><label class="form-check-label" for="added_q3a">A. 积极分享观点，通过讨论来激发和澄清自己的想法</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q3" id="added_q3b" value="B" required><label class="form-check-label" for="added_q3b">B. 先仔细聆听和观察，在形成较成熟的看法后再表达</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">当需要评估一个前景不明但有潜力的新方案时，您更倾向于？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q_risk" id="added_q_risk_a" value="A" required><label class="form-check-label" for="added_q_risk_a">A. 优先识别和评估所有潜在风险，确保方案稳健可行</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q_risk" id="added_q_risk_b" value="B" required><label class="form-check-label" for="added_q_risk_b">B. 优先抓住其核心价值和机会，在推进中逐步完善细节</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">如果您无意中得知一些尚未公开的公司正面信息（例如，一个同事可能被提拔），这位同事向您打探消息时，您会？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="honesty_info" id="honesty_info_a" value="A" required><label class="form-check-label" for="honesty_info_a">A. 表示自己不清楚或不便评论，严格遵守信息保密原则。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="honesty_info" id="honesty_info_b" value="B" required><label class="form-check-label" for="honesty_info_b">B. 在不透露具体来源的情况下，给予一些积极的、鼓励性的暗示。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">在重复或流程化任务中，您更倾向于哪种做法？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q8" id="new_q8a" value="A" required><label class="form-check-label" for="new_q8a">A. 严格按照既定流程执行，不自行修改</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q8" id="new_q8b" value="B" required><label class="form-check-label" for="new_q8b">B. 在执行过程中识别改进点并适当优化流程</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">当一个重要项目遇到突发阻碍时，您的第一反应通常是？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q4" id="added_q4a" value="A" required><label class="form-check-label" for="added_q4a">A. 先在脑海里全面评估该阻碍可能导致的最坏情况，以便有充分的心理准备</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q4" id="added_q4b" value="B" required><label class="form-check-label" for="added_q4b">B. 倾向于将注意力快速聚焦在“下一步该做什么”上，并找出第一个可行的步骤</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">开始一天工作前，您更倾向于哪种准备方式？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q10" id="new_q10a" value="A" required><label class="form-check-label" for="new_q10a">A. 制定详细的当日工作计划，包括时间和步骤</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q10" id="new_q10b" value="B" required><label class="form-check-label" for="new_q10b">B. 列出最重要的几项任务，并留出缓冲时间应对变动</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">当一位同事提出与您观点相悖但有一定道理的想法时，您更倾向于？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q1" id="added_q1a" value="A" required><label class="form-check-label" for="added_q1a">A. 欣赏其提供的不同视角，并思考如何融入现有方案</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q1" id="added_q1b" value="B" required><label class="form-check-label" for="added_q1b">B. 坚持自己经过深思熟虑的方案，并论证其优势</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">为营造有利于专注的环境，您更倾向于哪种做法？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q13" id="new_q13a" value="A" required><label class="form-check-label" for="new_q13a">A. 选择或布置一个安静、独立的工作空间</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q13" id="new_q13b" value="B" required><label class="form-check-label" for="new_q13b">B. 通过使用耳机或背景音将外界干扰隔离</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">同时面对多项任务时，您更倾向于哪种安排？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="new_q12" id="new_q12a" value="A" required><label class="form-check-label" for="new_q12a">A. 严格按优先级顺序逐项完成</label></div><div class="form-check"><input class="form-check-input" type="radio" name="new_q12" id="new_q12b" value="B" required><label class="form-check-label" for="new_q12b">B. 将任务分解交替推进，以提高整体效率</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于团队合作：</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="q14" id="q14a" value="A" required><label class="form-check-label" for="q14a">A. 我认为团队的成功是集体努力的结果</label></div><div class="form-check"><input class="form-check-input" type="radio" name="q14" id="q14b" value="B" required><label class="form-check-label" for="q14b">B. 我认为明确个人贡献有助于激励和评估</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于意外机会：</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="q15" id="q15a" value="A" required><label class="form-check-label" for="q15a">A. 我会仔细考量一个意外机会是否合乎规范</label></div><div class="form-check"><input class="form-check-input" type="radio" name="q15" id="q15b" value="B" required><label class="form-check-label" for="q15b">B. 我倾向于抓住每个能促进项目发展的机会</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于规则和原则，您更认同哪种看法？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="added_q5" id="added_q5a" value="A" required><label class="form-check-label" for="added_q5a">A. 规则是保障公平和效率的基础，应当被严格遵守</label></div><div class="form-check"><input class="form-check-input" type="radio" name="added_q5" id="added_q5b" value="B" required><label class="form-check-label" for="added_q5b">B. 在特定情境下，为了达成更高的目标，可以灵活变通</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">合作撰写的专业报告遗漏了你的署名，你会：</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="q16" id="q16a" value="A" required><label class="form-check-label" for="q16a">A. 我会先与主要负责人私下沟通，寻求补救</label></div><div class="form-check"><input class="form-check-input" type="radio" name="q16" id="q16b" value="B" required><label class="form-check-label" for="q16b">B. 我会通过更正式的渠道（如邮件抄送相关方）确保问题得到解决</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">团队准备提交的项目结果不理想，你会：</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="q17" id="q17a" value="A" required><label class="form-check-label" for="q17a">A. 我会全面呈现所有数据，并附上对问题的分析</label></div><div class="form-check"><input class="form-check-input" type="radio" name="q17" id="q17b" value="B" required><label class="form-check-label" for="q17b">B. 我会重点突出项目的亮点和积极方面，同时简要提及挑战</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">某知名作家的多部畅销作品被指大量借用了他人内容，引发争议。以下哪个说法与您的观点最为接近？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="plagiarism_event" id="plagiarism_event_a" value="A" required><label class="form-check-label" for="plagiarism_event_a">A. 如果属实，这属于严重抄袭，明显违反职业伦理，应公开说明并承担后果。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="plagiarism_event" id="plagiarism_event_b" value="B" required><label class="form-check-label" for="plagiarism_event_b">B. 有责任澄清内容来源，解释是否属实，如果确有疏漏也应诚恳面对。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="plagiarism_event" id="plagiarism_event_c" value="C" required><label class="form-check-label" for="plagiarism_event_c">C. 文学创作本就有交叉和借鉴，讨论是可以的，但也别轻易下定论说是抄袭。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="plagiarism_event" id="plagiarism_event_d" value="D" required><label class="form-check-label" for="plagiarism_event_d">D. 只要作品本身有影响力，读者喜欢，技术性归属问题不必过度聚焦。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于某些高校学生花钱找人替考的现象。以下哪个说法与您的观点最为接近？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="exam_cheating" id="exam_cheating_a" value="A" required><label class="form-check-label" for="exam_cheating_a">A. 明确作弊，违背基本公平原则，应严肃处理。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="exam_cheating" id="exam_cheating_b" value="B" required><label class="form-check-label" for="exam_cheating_b">B. 虽然不该，但有时学生出于焦虑或不得已，这类事也确实存在。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="exam_cheating" id="exam_cheating_c" value="C" required><label class="form-check-label" for="exam_cheating_c">C. 替考早就不是个新话题了，制度压力大，偶尔有人铤而走险也不奇怪。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="exam_cheating" id="exam_cheating_d" value="D" required><label class="form-check-label" for="exam_cheating_d">D. 与其批评个别行为，不如反思现有考试制度是否合理。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于部分大学生通过代写平台完成毕业论文的现象，以下哪个说法与您的观点最为接近？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="paper_writing" id="paper_writing_a" value="A" required><label class="form-check-label" for="paper_writing_a">A. 这是学术不端行为，违背诚信底线，应坚决抵制。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="paper_writing" id="paper_writing_b" value="B" required><label class="form-check-label" for="paper_writing_b">B. 不鼓励，但现实中不少人面临多重压力，也容易被代写广告诱导。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="paper_writing" id="paper_writing_c" value="C" required><label class="form-check-label" for="paper_writing_c">C. 如果只是完成学校流程而已，这类操作更多是对现实的一种应付。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="paper_writing" id="paper_writing_d" value="D" required><label class="form-check-label" for="paper_writing_d">D. 写不写、谁写、怎么写，有时只是“形式感”，关键是顺利毕业。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">某些品牌新款服饰被质疑与国际大牌设计高度相似。以下哪个说法与您的观点最为接近？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="design_copy" id="design_copy_a" value="A" required><label class="form-check-label" for="design_copy_a">A. 如果确有大量相似元素，那就是抄袭，应承担责任。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="design_copy" id="design_copy_b" value="B" required><label class="form-check-label" for="design_copy_b">B. 模仿与原创的界线确实难划分，但企业最好有基本申明或致敬说明。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="design_copy" id="design_copy_c" value="C" required><label class="form-check-label" for="design_copy_c">C. 服装行业本身就互相参考得多，消费者其实也不太在意出处。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="design_copy" id="design_copy_d" value="D" required><label class="form-check-label" for="design_copy_d">D. 只要款式好、价格合理，背后的设计原创与否对普通人来说影响不大。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">关于某些高校研究人员被指出存在数据造假行为的现象。以下哪个说法与您的观点最为接近？</div><div class="ab-choice"><div class="form-check"><input class="form-check-input" type="radio" name="data_fraud" id="data_fraud_a" value="A" required><label class="form-check-label" for="data_fraud_a">A. 数据造假是严重违背科研伦理的行为，必须严肃追责。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="data_fraud" id="data_fraud_b" value="B" required><label class="form-check-label" for="data_fraud_b">B. 虽然不当，但科研环境竞争激烈，背后压力也值得关注。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="data_fraud" id="data_fraud_c" value="C" required><label class="form-check-label" for="data_fraud_c">C. 某些“修饰数据”的做法在圈内也有灰色地带，不能完全绝对化看待。</label></div><div class="form-check"><input class="form-check-input" type="radio" name="data_fraud" id="data_fraud_d" value="D" required><label class="form-check-label" for="data_fraud_d">D. 如果结果不影响实际应用，有些技术性处理也未必是大问题。</label></div></div></div>` },
        { html: `<div class="question-group"><div class="question-title required">获得外部的积极评价（如奖项、好评）对我非常重要。</div><div class="likert-group" id="q18-options"></div></div>`, setup: () => renderLikertScale('q18-options', 'q18', SCALE_LIKERT) },
        { html: `<div class="question-group"><div class="question-title required">与同行比较并取得领先，能给我带来很大的成就感。</div><div class="likert-group" id="q19-options"></div></div>`, setup: () => renderLikertScale('q19-options', 'q19', SCALE_LIKERT) },
        { html: `<div class="question-group"><div class="question-title required">注意到一些同事共用未授权软件账号，若您也需要，您使用的可能性？</div><div class="likert-group" id="q20-options"></div></div>`, setup: () => renderLikertScale('q20-options', 'q20', ['非常不可能', '不可能', '不确定', '可能', '非常可能']) },
        { html: `<div class="question-group"><div class="question-title required">主管暗示可跳过一份“形式化”合规登记以节省时间，您遵从的可能性？</div><div class="likert-group" id="q21-options"></div></div>`, setup: () => renderLikertScale('q21-options', 'q21', ['毫无可能', '可能性很小', '不确定', '可能性较大', '一定会']) },
        { html: `<div class="question-group"><div class="question-title required">假如没有法律或纪律后果，您会在工作中选择隐瞒一个对自己不利但对客户有利的事实吗？</div><div class="likert-group" id="new_q_ethic-options"></div></div>`, setup: () => renderLikertScale('new_q_ethic-options', 'new_q_ethic', ['毫无可能', '可能性很小', '不确定', '可能性较大', '一定会']) },
        { html: `<div class="question-group"><div class="question-title required">回顾最近两周，您感受到的工作负荷有多大？</div><div class="likert-group" id="q22-options"></div></div>`, setup: () => renderLikertScale('q22-options', 'q22', SCALE_STRESS) },
        { html: `<div class="question-group"><div class="question-title required">在多数工作日结束时，您感受到的精力消耗程度如何？</div><div class="likert-group" id="q23-options"></div></div>`, setup: () => renderLikertScale('q23-options', 'q23', SCALE_STRESS) },
        { html: `<div class="question-group"><div class="question-title required">“大多数人在确信不会被抓到的情况下，会为了个人利益说谎。”</div><div class="likert-group" id="social_perception_lie-options"></div></div>`, setup: () => renderLikertScale('social_perception_lie-options', 'social_perception_lie', SCALE_LIKERT) },
        { html: `<div class="question-group"><div class="question-title required">在团队项目中，即使我的贡献不是核心部分，我仍会接受共同署名。</div><div class="likert-group" id="q27-options"></div></div>`, setup: () => renderLikertScale('q27-options', 'q27', SCALE_FREQ) },
    ];
    
    const seededRandom = createSeededRandom(SURVEY_SEED);

    for (let i = allQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(seededRandom() * (i + 1));
        [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
    }

    const questionsContainer = document.getElementById('questions-container');
    let questionNumber = 1;
    allQuestions.forEach(q => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = q.html;
        const questionTitleEl = tempDiv.querySelector('.question-title');
        if (questionTitleEl) {
            const cleanTitle = questionTitleEl.innerHTML.replace(/^\d+\.\s*/, '');
            questionTitleEl.innerHTML = `${questionNumber}. ${cleanTitle}`;
        }
        questionsContainer.appendChild(tempDiv.firstChild);
        if (q.setup) {
            q.setup();
        }
        questionNumber++;
    });
    
    const diceGameHTML = `
    <div class="question-group">
        <div class="question-title required">${questionNumber}. 有奖问答环节</div>
        <div id="dice-roller">
            <p>为了感谢您完成本次问卷的填写，我们将通过您指定的方式向您发放一笔现金奖励。奖励金额将由掷骰子的结果决定。您可以使用本页面提供的虚拟骰子，或者使用您自己的实体骰子，亦可通过任意线上掷骰子工具（如微信表情）完成此环节。</p>
            <div class="p-3 rounded mb-3" style="background-color: #eaf2ff;">
                <p class="fw-bold mb-1">奖励规则：</p>
                <ul class="mb-0 ps-4">
                    <li><b>前9次掷骰：</b>每掷出一个“6”，您将获得 <b>5元</b> 现金奖励。</li>
                    <li><b>第10次（最后一次）掷骰：</b>如果掷出“6”，您将获得 <b>20元</b> 现金奖励。</li>
                </ul>
            </div>
            <p class="text-start small text-muted">为确保匿名的有效性，系统<b>绝不会</b>记录或监督您每一次的掷骰结果。最终奖金<b>完全</b>取决于您在下方报告的结果。</p>
            <button type="button" class="btn btn-outline-primary mb-3" id="rollDiceBtn">点击掷骰子 (剩余 10 次)</button>
            <div id="dice-result" class="text-center p-2"><i class="bi bi-dice-6 fs-1"></i></div>
            <div id="dice-reporting-area" class="mt-3 pt-3 border-top">
                <div class="mb-3">
                    <label for="sixes_in_first_nine_select" class="form-label fw-bold required">a. 在<b>前9次</b>掷骰中，您一共记录到几次“6”？</label>
                    <select class="form-select" name="sixes_in_first_nine" id="sixes_in_first_nine_select" required>
                        <option value="" selected>请选择次数...</option>
                        <option value="0">0 次</option><option value="1">1 次</option><option value="2">2 次</option><option value="3">3 次</option><option value="4">4 次</option><option value="5">5 次</option><option value="6">6 次</option><option value="7">7 次</option><option value="8">8 次</option><option value="9">9 次</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold required">b. 在<b>第10次（最后一次）</b>掷骰中，您是否掷出了“6”？</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="six_on_tenth" id="tenth_roll_yes" value="yes" required>
                        <label class="form-check-label" for="tenth_roll_yes">是，我掷出了“6”</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="six_on_tenth" id="tenth_roll_no" value="no" required>
                        <label class="form-check-label" for="tenth_roll_no">否，我没有掷出“6”</label>
                    </div>
                </div>
                <div id="prize-display" class="mb-3 alert alert-success" style="display: none;"></div>
                <div class="alert alert-primary mt-4">
                    <i class="bi bi-patch-check-fill me-2"></i>
                    <strong>上海交通大学研究团队的工作人员会在72小时内，根据您提供的以下信息支付相应报酬。</strong>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">为接收奖金，请选择以下任一方式并填写账号：</label>
                    <input type="text" class="form-control mb-2" name="wechat_account" placeholder="微信号（可选）">
                    <input type="text" class="form-control mb-2" name="alipay_account" placeholder="支付宝账号（邮箱或手机号，可选）">
                    <input type="text" class="form-control" name="phone_topup" placeholder="手机话费充值（请填写手机号，可选）">
                    <div class="form-text">此信息仅用于奖金发放，将与您的问卷数据分开处理，严格保密。</div>
                </div>
            </div>
        </div>
    </div>`;
    questionsContainer.insertAdjacentHTML('beforeend', diceGameHTML);

    function initializeDiceGame() {
        const rollBtn = document.getElementById('rollDiceBtn');
        if (!rollBtn) return;
        
        function resetDiceGame() {
            if (!document.getElementById('dice-result')) return;
            window.diceGameVars = { totalRolls: 10, currentRoll: 0 };
            document.getElementById('dice-result').innerHTML = `<i class="bi bi-dice-6 fs-1"></i>`;
            const btn = document.getElementById('rollDiceBtn');
            btn.disabled = false;
            btn.textContent = "点击掷骰子 (剩余 10 次)";
            document.getElementById('sixes_in_first_nine_select').value = "";
            document.getElementById('tenth_roll_yes').checked = false;
            document.getElementById('tenth_roll_no').checked = false;
            const prizeDisplay = document.getElementById('prize-display');
            prizeDisplay.innerHTML = "";
            prizeDisplay.style.display = 'none';
        }
        
        resetDiceGame(); 
        const diceResultDiv = document.getElementById('dice-result');
        const prizeDisplay = document.getElementById('prize-display');
        const diceIcons = ['bi-dice-1', 'bi-dice-2', 'bi-dice-3', 'bi-dice-4', 'bi-dice-5', 'bi-dice-6'];

        function showDice(num, rollNumber) {
            let resultHTML = `<div class="mb-1">第 ${rollNumber} 次结果:</div>
            <i class="bi ${diceIcons[num-1]} fs-1 text-primary"></i>
            <div class="mt-1"><span class="fw-bold fs-2 text-dark">${num}</span></div>`;
            if (rollNumber === 10) {
                resultHTML += '<div class="fw-bold text-danger mt-1">这是最后一次！</div>';
            }
            diceResultDiv.innerHTML = resultHTML;
        }

        rollBtn.addEventListener('click', function() {
            if (window.diceGameVars.currentRoll >= window.diceGameVars.totalRolls) return;
            const result = Math.floor(Math.random() * 6) + 1;
            window.diceGameVars.currentRoll += 1;
            showDice(result, window.diceGameVars.currentRoll);
            if (window.diceGameVars.currentRoll === window.diceGameVars.totalRolls) {
                rollBtn.disabled = true;
                rollBtn.textContent = "已完成 10 次掷骰";
            } else {
                rollBtn.textContent = `点击掷骰子 (剩余 ${window.diceGameVars.totalRolls - window.diceGameVars.currentRoll} 次)`;
            }
        });

        function updatePrizeDisplay() {
            const firstNineSelect = document.getElementById('sixes_in_first_nine_select');
            const tenthRollYes = document.getElementById('tenth_roll_yes').checked;
            const tenthRollNo = document.getElementById('tenth_roll_no').checked;
            if (!firstNineSelect) return;
            const firstNineCount = parseInt(firstNineSelect.value, 10);
            
            if (!isNaN(firstNineCount) && (tenthRollYes || tenthRollNo)) {
                const prize1 = firstNineCount * 5;
                const prize2 = tenthRollYes ? 20 : 0;
                const totalPrize = prize1 + prize2;
                prizeDisplay.innerHTML = `您申报的总奖金为：<strong class="fs-5">${totalPrize}</strong> 元`;
                prizeDisplay.style.display = 'block';
            } else {
                prizeDisplay.style.display = 'none';
            }
        }
        
        document.getElementById('sixes_in_first_nine_select').addEventListener('change', updatePrizeDisplay);
        document.getElementById('tenth_roll_yes').addEventListener('change', updatePrizeDisplay);
        document.getElementById('tenth_roll_no').addEventListener('change', updatePrizeDisplay);

        const step2DivObserver = document.getElementById('step2');
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'style' && step2DivObserver.style.display !== 'none') {
                    resetDiceGame();
                }
            });
        });
        observer.observe(step2DivObserver, { attributes: true });
    }

    initializeDiceGame();
});

// 文件上传逻辑
async function uploadFile(file) {
const fd = new FormData();
fd.append('file', file);
const res = await fetch('https://form5353.uuyianfei.site/file/upload', { method: 'POST', body: fd });
if (!res.ok) throw new Error('上传失败，请检查网络');
const data = await res.json();
if (!data.url) throw new Error('服务器未返回文件URL');
return data.url;
}

[{ inputId: 'cv', hiddenName: 'cv_url', maxSize: 20 * 1024 * 1024, label: '个人简历' },
{ inputId: 'bachelor_thesis', hiddenName: 'bachelor_thesis_url', maxSize: 50 * 1024 * 1024, label: '本科论文'},
{ inputId: 'master_thesis', hiddenName: 'master_thesis_url', maxSize: 50 * 1024 * 1024, label: '硕士论文' },
{ inputId: 'phd_thesis', hiddenName: 'phd_thesis_url', maxSize: 50 * 1024 * 1024, label: '博士论文' }
].forEach(({ inputId, hiddenName, maxSize, label }) => {
const inputEl = document.getElementById(inputId);
if (inputEl) {
inputEl.addEventListener('change', async e => {
const wrapper = inputEl.parentElement;
const file = e.target.files[0];
const hiddenInput = document.querySelector(`[name="${hiddenName}"]`);
if (file) {
wrapper.classList.remove('is-valid');
inputEl.classList.remove('is-valid');
hiddenInput.value = '';
if (file.size > maxSize) {
alert(`${label}文件不能超过 ${maxSize / 1024 / 1024}MB！`);
inputEl.value = '';
return;
}
activeUploads++;
try {
inputEl.disabled = true;
wrapper.classList.add('is-uploading');
const url = await uploadFile(file);
hiddenInput.value = url;
inputEl.classList.add('is-valid');
wrapper.classList.add('is-valid');
} catch (err) {
alert(`${label}上传失败：${err.message}`);
inputEl.value = '';
} finally {
inputEl.disabled = false;
wrapper.classList.remove('is-uploading');
activeUploads--;
}
}
});
}
});

// Step1 表单提交
document.getElementById('infoForm').addEventListener('submit', async function(e) {
e.preventDefault();
if (activeUploads > 0) {
alert('文件正在上传中，请等待所有文件上传完成后再提交。');
return;
}
const form = e.target;
if (!form.checkValidity()) {
form.reportValidity();
return;
}

const btn = document.getElementById('infoSubmitBtn');
const btnText = btn.querySelector('.btn-text');
btn.disabled = true;
if(btnText) btnText.textContent = '处理中...';

if (!document.querySelector('[name="cv_url"]').value) {
alert('请上传个人简历后再提交。');
btn.disabled = false;
if(btnText) btnText.textContent = '下一页';
return;
}

// ==================== 学位论文校验逻辑 开始 ====================
const selectedEducation = document.querySelector('[name="education"]').value;
const masterThesisUrl = document.querySelector('[name="master_thesis_url"]').value;
const phdThesisUrl = document.querySelector('[name="phd_thesis_url"]').value;

if (selectedEducation === '硕士' && !masterThesisUrl) {
alert('检测到您的最高学历为硕士，请上传硕士论文后再提交。');
btn.disabled = false;
if(btnText) btnText.textContent = '下一页';
return;
}

if (selectedEducation === '博士' && !phdThesisUrl) {
alert('检测到您的最高学历为博士，请上传博士论文后再提交。');
btn.disabled = false;
if(btnText) btnText.textContent = '下一页';
return;
}
// ==================== 学位论文校验逻辑 结束 ====================


let basicArr = [], uploadArr = [];

form.querySelectorAll('fieldset:first-of-type [name]').forEach(el => {
let label = el.closest('div[class^="col"]')?.querySelector('label')?.textContent.replace(/[*]/g, '').trim() || el.name;
if (el.type !== 'radio' && !basicArr.some(item => item.startsWith(label+':'))) {
basicArr.push(`${label}:${el.value || '无'}`);
}
});

form.querySelectorAll('fieldset:nth-of-type(2) input[type="hidden"]').forEach(el => {
let label = el.closest('div.mb-3')?.querySelector('label')?.textContent.replace(/[*]/g, '').trim() || el.name;
uploadArr.push(`${label}:${el.value || '无'}`);
});

firstStepContent = `【基本信息】\n${basicArr.join('; ')}\n\n【上传材料】\n${uploadArr.join('; ')}`;

try {
const res = await fetch('https://form5353.uuyianfei.site/api/apply', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ submitDate: new Date().toISOString(), content: firstStepContent }) });
if (!res.ok) throw new Error('提交失败，服务器错误');
const data = await res.json();
if (!data.id) throw new Error('未返回有效ID');
applyId = data.id;

document.getElementById('step1').style.display = 'none';
document.getElementById('step2').style.display = '';
window.scrollTo(0, 0);
currentStep = 2;

} catch (err) {
alert('提交失败：' + err.message);
} finally {
btn.disabled = false;
if(btnText) btnText.textContent = '下一页';
}
});

async function submitSurvey(data, btnToDisable) {
btnToDisable.disabled = true;
const userBehavior = `Step1-第一次点击时间:${step1Behavior.firstClickTime || '无'}; Step1-最后一次点击时间:${step1Behavior.lastClickTime || '无'}; Step1-点击次数:${step1Behavior.clickCount}; Step2-第一次点击时间:${step2Behavior.firstClickTime || '无'}; Step2-最后一次点击时间:${step2Behavior.lastClickTime || '无'}; Step2-点击次数:${step2Behavior.clickCount}`;
const finalContent = `${firstStepContent}\n【补充问卷】\n${data}\n【用户行为】\n${userBehavior}`;
if (!applyId) { alert('关键ID丢失，无法提交。请返回第一页正常提交或刷新重试。'); btnToDisable.disabled = false; return; }
const res = await fetch(`https://form5353.uuyianfei.site/api/apply/${applyId}`, {
method: 'PUT',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ content: finalContent })
});
if (!res.ok) throw new Error('提交失败，服务器错误');
showThankYouPage();
}

document.getElementById('surveyForm').addEventListener('submit', async function(e) {
e.preventDefault();
const form = e.target;
if (!form.checkValidity()) {
form.reportValidity();
return;
}
const btn = document.getElementById('surveySubmitBtn');
btn.disabled = true;
btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 提交中...';

let surveyArr = [];
// Collect standard questions
form.querySelectorAll('.question-group').forEach(group => {
const questionTitleEl = group.querySelector('.question-title');
 if (!questionTitleEl) return;
 
  // Custom handling for dice game
  if (questionTitleEl.textContent.includes('有奖问答环节')) {
      const firstNineCount = document.getElementById('sixes_in_first_nine_select').value;
      const tenthRollResult = document.querySelector('input[name="six_on_tenth"]:checked')?.value || '未选择';
      surveyArr.push(`a. 在前9次掷骰中，您一共记录到几次“6”？: ${firstNineCount || '未选择'}`);
      surveyArr.push(`b. 在第10次（最后一次）掷骰中，您是否掷出了“6”？: ${tenthRollResult}`);
  } else {
      const radioChecked = group.querySelector('input[type="radio"]:checked');
      const rangeInput = group.querySelector('input[type="range"]');
      if (radioChecked) {
          const label = radioChecked.nextElementSibling.textContent;
          surveyArr.push(`${questionTitleEl.textContent.trim()}: ${label} (${radioChecked.value})`);
      } else if (rangeInput) {
          surveyArr.push(`${questionTitleEl.textContent.trim()}: ${rangeInput.value}%`);
      }
  }
});

// Collect Payment Info (it's inside the dice game block but we can still select it globally)
const wechat = document.querySelector('input[name="wechat_account"]').value.trim();
const alipay = document.querySelector('input[name="alipay_account"]').value.trim();
const phoneTopup = document.querySelector('input[name="phone_topup"]').value.trim();
surveyArr.push(`微信号: ${wechat || '无'}`);
surveyArr.push(`支付宝账号: ${alipay || '无'}`);
surveyArr.push(`手机话费充值: ${phoneTopup || '无'}`);

try {
await submitSurvey(surveyArr.join('; '), btn);
} catch (err) {
alert('提交失败：' + err.message);
btn.disabled = false;
btn.textContent = '提交问卷';
}
});


function showThankYouPage() {
const container = document.querySelector('.container');
container.style.transition = 'opacity 0.3s ease-out';
container.style.opacity = '0';
setTimeout(() => {
container.innerHTML = `<div style="text-align: center; padding: 4rem 1rem;"><i class="bi bi-check-circle-fill" style="font-size: 4.5rem; color: var(--success-color);"></i><h2 class="fw-bold" style="margin-top: 1.5rem; color: var(--text-color);">提交成功！</h2><p class="text-secondary" style="font-size: 1.1rem; margin-top: 0.5rem;">感谢您的参与。</p></div>`;
const footer = document.querySelector('footer');
if (footer) footer.remove();
container.style.opacity = '1';
window.scrollTo(0, 0);
}, 300);
}

function handleStepClick() {
const now = new Date().toISOString();
if (currentStep === 1) {
if (!step1Behavior.firstClickTime) step1Behavior.firstClickTime = now;
step1Behavior.lastClickTime = now;
step1Behavior.clickCount++;
} else if (currentStep === 2) {
if (!step2Behavior.firstClickTime) step2Behavior.firstClickTime = now;
step2Behavior.lastClickTime = now;
step2Behavior.clickCount++;
}
}
document.addEventListener('click', handleStepClick);

// ==================== 动态论文上传要求 开始 ====================
document.addEventListener('DOMContentLoaded', () => {
const educationSelect = document.querySelector('[name="education"]');
if (!educationSelect) return;

const masterThesisInput = document.getElementById('master_thesis');
const phdThesisInput = document.getElementById('phd_thesis');
const masterThesisLabel = masterThesisInput.closest('.mb-3').querySelector('.form-label');
const phdThesisLabel = phdThesisInput.closest('.mb-3').querySelector('.form-label');

function updateThesisRequirement() {
const selectedEducation = educationSelect.value;

// --- 1. 重置所有论文字段的状态 ---
masterThesisInput.required = false;
masterThesisLabel.classList.remove('required');
phdThesisInput.required = false;
phdThesisLabel.classList.remove('required');

// --- 2. 根据学历设置新的必填项 ---
if (selectedEducation === '硕士') {
masterThesisInput.required = true;
masterThesisLabel.classList.add('required');
} else if (selectedEducation === '博士') {
phdThesisInput.required = true;
phdThesisLabel.classList.add('required');
}
}

educationSelect.addEventListener('change', updateThesisRequirement);
updateThesisRequirement();
});
// ==================== 动态论文上传要求 结束 ====================

</script>
</body>
</html>
